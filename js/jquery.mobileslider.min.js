(function(a){a.mobileSlider=function(d,i){var D=a(d),g=12,c=500,x=null,b=null,u=Math.PI*2,f=Math.PI/2,B=10,h=null,t=null,p=null,y=0,m=1,r=0,n=0,o,s,w,v=null,e=function(){o.text(m);s.text(r);w.text(Math.ceil(n*100));setTimeout(function(){e()},50)},l=function(){x.putImageData(b,0,0);x.beginPath();x.arc(20,20,13,-f,(u*n)-f,false);x.stroke()},j=function(){p.children("li:nth-child("+(r+1)+")").children("span").addClass("active");k()},q=function(){p.children("li:nth-child("+(r+1)+")").children("span").removeClass("active");if(r!==y-1){t.animate({left:"-=320"},c,function(){r++;if(r-m<g-1){a(h).css("margin-top",(r-m+1)*40)}j()});if(r-m>=g-2){m++;p.animate({"margin-top":"-=40"},c)}}else{t.animate({left:"0"},c,function(){p.animate({"margin-top":"0"},c,function(){m=1;r=0;a(h).css("margin-top","0");j()})})}},k=function(){v=setTimeout(function(){n+=0.01;l();if(n<1){k()}else{n=0;l();q()}},B)},C=function(E){if(E<m-1){a(h).css("margin-top","0");m--;p.animate({"margin-top":"+=40"},c)}else{a(h).css("margin-top",(E-m+1)*40)}t.stop();p.children("li:nth-child("+(r+1)+")").children("span").removeClass("active");p.children("li:nth-child("+(E+1)+")").children("span").addClass("active");clearTimeout(v);n=0;l();t.animate({left:E*-320},c,function(){r=E;j()})},A=function(){var F,E=(D.find(".phone").attr("class").indexOf("left")!==-1)?"right":"left";D.append('<div class="numerals '+E+'"><canvas class="progressbar" width="40" height="40"></canvas><ul></ul></div>');p=D.find(".numerals ul");p.delegate("li","click",function(){var G=p.children("li").index(a(this));C(G)});for(F=1;F<=y;F++){p.append("<li><span>"+F+"</span></li>")}},z=function(){var G=a.extend({},a.mobileSlider.defaultOptions,i),E=D.find(".phone"),K,J=D.find(".phone").children("a"),I=[],F=[],L,H;a.each(J,function(){I.push(a(this).attr("href"))});E.html('<div class="spinner"></div><div class="wrapper"><div class="image_container"></div></div>');t=D.find(".image_container");K=D.find(".spinner");L=E.css("background-image").replace("url(","").replace(")","").replace(/"/g,"");H=K.css("background-image").replace("url(","").replace(")","").replace(/"/g,"");a("<img>").attr("src",H).load(function(){a("<img>").attr("src",L).load(function(){K.show();a.each(I,function(){var M=new Image();a(M).bind("load",function(){F.push(this);if(F.length>=I.length){K.hide();a.each(I,function(){t.append(a("<img>").attr("src",this))});y=t.children("img").length;t.css("width",y*320);A();h=D.find(".progressbar").get(0);x=h.getContext("2d");x.beginPath();x.strokeStyle="#fff";x.lineCap="round";x.closePath();x.fill();x.lineWidth=4;b=x.getImageData(0,0,40,40);if(G.debug){D.find(".phone").prepend('<div class="debug_console"><div><span class="name">top_numeral</span><span class="value var_top_numeral">Value</span></div><div><span class="name">curr_slide_index</span><span class="value var_curr_slide_index">Value</span></div><div><span class="name">progress</span><span class="value var_progress">Value</span></div></div>');o=D.find(".var_top_numeral");s=D.find(".var_curr_slide_index");w=D.find(".var_progress");e()}j()}a(M).unbind("load error")});M.src=this})})});B=G.duration/100;c=G.transition};z()};a.mobileSlider.defaultOptions={duration:5000,transition:500,debug:false};a.fn.mobileSlider=function(b){return this.each(function(){a.mobileSlider(this,b)})}}(jQuery));